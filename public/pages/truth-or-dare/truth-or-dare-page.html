<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:description"
        content="Truth or Dare cranks up the fun with wild prompts and tough choices. Pick truth or dare, reveal it to the group, and either spill your secrets or complete the dareâ€¦fail, and a punishment awaits!">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://code.responsivevoice.org/ 'unsafe-inline';">
        <title>TRUTH OR DARE</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="gamemode-page-styles.css">
    <link rel="stylesheet" href="rotate-device.css">

    <script src="https://code.responsivevoice.org/responsivevoice.js"></script>

    <link rel="icon" type="image/png" sizes="15x16" href="/images/favicons/blue/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="30x32" href="/images/favicons/blue/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="45x48" href="/images/favicons/blue/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="60x64" href="/images/favicons/blue/favicon-64x64.png">
    <link rel="icon" type="image/png" sizes="89x96" href="/images/favicons/blue/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/images/favicons/blue/favicon-128x128.png">
    <link rel="icon" type="image/png" sizes="238x256" href="/images/favicons/blue/favicon-256x256.png">
    <link rel="icon" type="image/png" sizes="476x512" href="/images/favicons/blue/favicon-512x512.png">
    <link rel="apple-touch-icon" sizes="53x57" href="/images/favicons/blue/favicon-57x57.png">
    <link rel="apple-touch-icon" sizes="67x72" href="/images/favicons/blue/favicon-72x72.png">
    <link rel="apple-touch-icon" sizes="106x114" href="/images/favicons/blue/favicon-114x114.png">
    <link rel="apple-touch-icon" sizes="112x120" href="/images/favicons/blue/favicon-120x120.png">
    <link rel="apple-touch-icon" sizes="134x144" href="/images/favicons/blue/favicon-144x144.png">
    <link rel="apple-touch-icon" sizes="141x152" href="/images/favicons/blue/favicon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x180" href="/images/favicons/blue/favicon-180x180.png">
    <meta name="msapplication-TileImage" content="/images/favicons/blue/favicon-144x144.png">
    <meta name="msapplication-TileColor" content="#202020">
    <meta name="msapplication-square70x70logo" content="/images/favicons/blue/favicon-70x70.png">
    <meta name="msapplication-square150x150logo" content="/images/favicons/blue/favicon-150x150.png">
    <meta name="msapplication-square310x310logo" content="/images/favicons/blue/favicon-310x310.png">
    <link rel="icon" type="image/png" sizes="179x192" href="/images/favicons/blue/favicon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/images/favicons/blue/favicon-512x512.png">

    <style>
        .landscape-message {
            color: var(--primarypagecolour);
        }

        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .split-button-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            gap: 0.1vw;
            margin-top: 10px;
        }

        .split-question-button {
            background-color: #202020;
            border: var(--bordersize) solid var(--primarypagecolour);
            color: var(--primarypagecolour);
            font-size: 100%;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 50px;
            flex: 1;
            text-align: center;
            font-family: LemonMilk;
        }

        .split-question-button:hover {
            background-color: var(--primarypagecolour);
            color: #202020;
        }

        .or-text {
            font-size: 125%;
            color: #66CCFF;
            margin: 0 2%;
        }

        .gamemode-text {
            font-size: 450%;
        }

        @media (max-width: 400px),
        (max-height: 700px) {
            .split-question-button {
                font-size: 100%;
                border: var(--bordersize) solid #66CCFF;
                max-width: 40%;
            }

            .or-text {
                font-size: 100%;
                margin: 0 5%;
            }

            .gamemode-text {
                font-size: 350%;
            }
        }

        @media (max-width: 768px) and (orientation: landscape) {

            .container,
            .header,
            .back-button-container,
            .side-button-container,
            .tts-button {
                display: none;
            }

            .overlay,
            .settings-box,
            .help-container,
            .extra-menu-container {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="full-page-container-static" id="full-page-container-static"></div>
    <header class="header" id="header">
        <div class="icon-container extra-menu-icon">
            <div class="extra-menu-icon">
                <img src="/images/icons/extra-menu-icon.svg" alt="Extra Menu">
            </div>
        </div>
        <div class="logo-container">
            <a href="/">
                <img src="/images/logo.svg" alt="OVEREXPOSED Logo" class="logo">
            </a>
        </div>
        <div class="icon-container settings-icon">
            <div class="settings-icon">
                <img src="/images/icons/settings.svg" alt="Settings">
            </div>
        </div>
        <div class="icon-container help-icon">
            <div class="help-icon">
                <img src="/images/icons/help-icon.svg" alt="Help">
            </div>
        </div>
    </header>
    <div class="help-container" id="help-container">
        <h2 class="help-title">HOW TO PLAY</h2>
        <p class="help-text">You'll be prompted to pick between <highlight>Truth</highlight> or <highlight>Dare
            </highlight> <br><br>
            <highlight>Truth</highlight> may reveal personal detail or secret. <br><br>
            <highlight>Dare</highlight> will require you to perform an action. <br><br>
            toggle <highlight class="NSFW">NSFW</highlight> mode and activate <br>
            <highlight>Drinking Punishments</highlight> where failing results in a drinking
            consequence
        </p>
    </div>
    <div class="landscape-message">
        Please rotate your phone to continue
        <img src="/images/icons/blue/rotate-phone-icon.svg" alt="Rotate Icon" class="rotate-icon">
    </div>
    <div class="extra-menu-container">
        <h1 class="extra-menu-title">Menu</h1>
        <a href="/"><button class="extra-menu-button">PARTY GAMES</button></a>
        <a href="/what-is-overexposed"><button class="extra-menu-button">WHAT IS OVEREXPOSED?</button></a>
        <div class="social-media-container">
            <div class="social-media-image-container">
                <a id="instagram-link" href="#"><img class="social-media-image" id="instagram-icon"
                        src="/images/icons/blue/instagram-icon.svg" alt="Instagram"></a>
            </div>
            <div class="social-media-image-container">
                <a id="tiktok-link" href="#"><img class="social-media-image" id="tik-tok-icon"
                        src="/images/icons/blue/tik-tok-icon.svg" alt="TikTok"></a>
            </div>
        </div>
    </div>
    <div class="overlay" id="overlay"></div>
    <div class="settings-box" id="settings-box">
        <h2 id="settings-title" class="settings-title">Settings</h2>
        <div class="settings-content">
            <div class="settings-option">
                <label for="settings-nsfw">NSFW</label>
                <label class="toggle-switch">
                    <input type="checkbox" style="opacity: 0;" id="settings-nsfw">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="settings-option">
                <label for="settings-vibration">VIBRATION</label>
                <label class="toggle-switch">
                    <input type="checkbox" style="opacity: 0;" id="settings-vibration">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="tts-voice-buttons">
            <div class="tts-voice-button" data-button="1" data-key="tts-voice-male1">M1</div>
            <div class="tts-voice-button" data-button="2" data-key="tts-voice-male2">M2</div>
            <div class="tts-voice-button" data-button="3" data-key="tts-voice-female1">F1</div>
            <div class="tts-voice-button" data-button="4" data-key="tts-voice-female2">F2</div>
        </div>
    </div>
    <div class="back-button-container">
        <button class="back-button">BACK</button>
    </div>
    <div class="container">
        <div class="content">
            <div class="gamemode-text">Truth</div>
            <div class="main-image-container">
                <img src="/images/blank-cards/truth-or-dare-blank-card.svg" alt="Truth or Dare Blank Card"
                    class="main-image">
                <div class="text-container">
                    Truth Or Dare
                </div>
                <div class="card-type-text">card type</div>
            </div>
            <div class="button-container">
                <div class="split-button-container">
                    <button id="truth-button" class="split-question-button">TRUTH</button>
                    <span class="or-text">or</span>
                    <button id="dare-button" class="split-question-button">DARE</button>
                </div>
            </div>
        </div>
    </div>
    <img src="/images/icons/blue/tts-icon.svg" alt="TTS Icon" class="tts-button disabled" id="tts-button">
    <script src="/header.js"></script>
    <script src="/social-media-links.js"></script>
    <script>
        document.documentElement.style.setProperty('--primarypagecolour', '#66CCFF');
        document.documentElement.style.setProperty('--secondarypagecolour', '#427BB9');

        //Header & Settings
        selectedColor = getComputedStyle(document.documentElement).getPropertyValue('--primarypagecolour');
        selectButton(selectedButton);
        //Truth Or Dare Page
        document.addEventListener('DOMContentLoaded', async () => {

            const questions = {
                truth: [],
                dare: []
            };

            const usedQuestions = {
                truth: [],
                dare: []
            };

            const packNameMapping = {
                'truth-or-dare-ice-breaker': 'Ice Breaker',
                'truth-or-dare-adult-confessions': 'Adult Confessions',
                'truth-or-dare-troubled-teens': 'Troubled Teens',
                'truth-or-dare-cheeky-confessions': 'Cheeky Confessions',
                'truth-or-dare-risky-revelations': 'Risky Revelations'
            };

            let hasBeenClicked = false;
            let voices = [];
            let ttsButtonTimeout;
            let currentUtterance = null;

            let currentQuestion;
            let currentPunishment;

            const punishmentEnabled = localStorage.getItem('truth-or-dare-settings-punishment') === 'true';
            const vibrationEnabled = localStorage.getItem('settings-vibration') === 'true';

            async function fetchQuestions() {
                const shouldFetchIceBreaker = localStorage.getItem('truth-or-dare-ice-breaker') === 'true';
                const shouldFetchAdultConfessions = localStorage.getItem('truth-or-dare-adult-confessions') === 'true';
                const shouldFetchTroubledTeens = localStorage.getItem('truth-or-dare-troubled-teens') === 'true';
                const shouldFetchCheekyConfessions = localStorage.getItem('truth-or-dare-cheeky-confessions') === 'true';
                const shouldFetchRiskyRevelations = localStorage.getItem('truth-or-dare-risky-revelations') === 'true';

                const files = [];
                if (shouldFetchIceBreaker) {
                    files.push('/questions/truth-or-dare/icebreaker.json');
                }
                if (shouldFetchAdultConfessions) {
                    files.push('/questions/truth-or-dare/adult-confessions.json');
                }
                if (shouldFetchTroubledTeens) {
                    files.push('/questions/truth-or-dare/troubled-teens.json');
                }
                if (shouldFetchCheekyConfessions) {
                    files.push('/questions/truth-or-dare/cheeky-confessions.json');
                }
                if (shouldFetchRiskyRevelations) {
                    files.push('/questions/truth-or-dare/risky-revelations.json');
                }

                try {
                    for (const file of files) {
                        const response = await fetch(file);
                        if (!response.ok) throw new Error(`Failed to fetch ${file}: ${response.statusText}`);
                        const data = await response.json();

                        for (const key of Object.keys(data)) {
                            const displayName = packNameMapping[key] || key;
                            data[key].forEach(item => {
                                if (item.question_type === 'Truth') {
                                    questions.truth.push({ ...item, packKey: displayName, punishment: item.punishment });
                                } else if (item.question_type === 'Dare') {
                                    questions.dare.push({ ...item, packKey: displayName, punishment: item.punishment });
                                }
                            });
                        }
                    }
                } catch (error) {
                    console.error('Error fetching questions:', error);
                }
            }

            function getRandomQuestion(type) {
                const availableQuestions = questions[type].filter(q => !usedQuestions[type].includes(q));
                if (availableQuestions.length === 0) {
                    document.querySelector('.text-container').textContent = `No more ${type} questions available.`;
                    return null;
                }
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                const question = availableQuestions[randomIndex];
                usedQuestions[type].push(question);
                return question;
            }

            function updateTextContainer(text, cardType, punishment) {
                const textContainer = document.querySelector('.text-container');
                textContainer.innerHTML =
                    `<span class="question-text">${text}</span>` +
                    (punishmentEnabled ? `<span class="punishment-text">Punishment: ${punishment}</span>` : '');

                const displayCardType = cardType.split('-').pop().toUpperCase();
                document.querySelector('.card-type-text').textContent = displayCardType;
                vibrateOnClick();
            }

            function updateTruthOrDareText(type) {
                const truthOrDareText = document.querySelector('.gamemode-text');
                truthOrDareText.textContent = type.charAt(0).toUpperCase() + type.slice(1);
            }

            function enableTTSButton() {
                const ttsButton = document.getElementById('tts-button');
                if (ttsButton.classList.contains('disabled')) {
                    ttsButton.classList.remove('disabled');
                }
            }

            function disableTTSButton() {
                const ttsButton = document.getElementById('tts-button');
                if (!ttsButton.classList.contains('disabled')) {
                    ttsButton.classList.add('disabled');
                    clearTimeout(ttsButtonTimeout);
                    ttsButtonTimeout = setTimeout(() => {
                        enableTTSButton();
                    }, 8000);
                }
            }

            function stopSpeech() {
                if (responsiveVoice.isPlaying()) {
                    responsiveVoice.cancel();
                }
            }
            function vibrateOnClick() {
                if (vibrationEnabled && 'vibrate' in navigator) {
                    navigator.vibrate(200);
                }
            }

            document.getElementById('truth-button').addEventListener('click', () => {
                stopSpeech();
                if (hasBeenClicked) return;
                hasBeenClicked = true;
                const question = getRandomQuestion('truth');
                if (question) {
                    updateTextContainer(question.question, question.packKey, question.punishment);
                    updateTruthOrDareText('truth');
                    enableTTSButton();

                    currentQuestion = question.question;
                    currentPunishment = question.punishment;
                }
                hasBeenClicked = false;
            });

            document.getElementById('dare-button').addEventListener('click', () => {
                stopSpeech();
                if (hasBeenClicked) return;
                hasBeenClicked = true;
                const question = getRandomQuestion('dare');
                if (question) {
                    updateTextContainer(question.question, question.packKey, question.punishment);
                    updateTruthOrDareText('dare');
                    enableTTSButton();

                    currentQuestion = question.question;
                    currentPunishment = question.punishment;
                }
                hasBeenClicked = false;
            });

            document.querySelector('.back-button').addEventListener('click', () => {
                window.location.href = 'truth-or-dare-settings';
            });

            function getSelectedVoice() {
                const voiceKeys = ['tts-voice-male1', 'tts-voice-male2', 'tts-voice-female1', 'tts-voice-female2'];
                voiceKeys.forEach(key => console.log(`${key}: ${localStorage.getItem(key)}`));

                const selectedVoiceKey = voiceKeys.find(key => localStorage.getItem(key) === 'true');

                console.log(`Selected Voice Key: ${selectedVoiceKey}`);

                switch (selectedVoiceKey) {
                    case 'tts-voice-male1':
                        return 'UK English Male';
                    case 'tts-voice-male2':
                        return 'US English Male';
                    case 'tts-voice-female1':
                        return 'UK English Female';
                    case 'tts-voice-female2':
                        return 'US English Female';
                    default:
                        return 'UK English Male';
                }
            }

            await fetchQuestions();


            document.getElementById('tts-button').addEventListener('click', () => {
                const gamemodeText = document.querySelector('.gamemode-text').textContent;
                const textToSpeak = `${gamemodeText} -  ${currentQuestion} -  Punishment -  ${currentPunishment}`; 
                const selectedVoiceName = getSelectedVoice();

                console.log(textToSpeak);

                if (selectedVoiceName) {
                    responsiveVoice.speak(textToSpeak, selectedVoiceName , { rate: 1});
                } else {
                    responsiveVoice.speak(textToSpeak, "US English Female", { rate: 1 });
                }

                disableTTSButton();
            });
        });
        //Make the Page size fit the page
        function updateVh() {
            let vh = window.innerHeight * 0.01; // Get 1% of the viewport height
            document.documentElement.style.setProperty('--vh', `${vh}px`); // Set the value in CSS
        }

        window.addEventListener('load', updateVh);
        window.addEventListener('resize', updateVh);

        //First Time Loading Page
        if (!localStorage.getItem('truth-or-dare-first-time')) {
            localStorage.setItem('truth-or-dare-first-time', 'true');
            toggleHelp();
        }
        // Page Load Transition
        const heading = document.createElement('h1');
        heading.textContent = 'TRUTH OR DARE';
        heading.style.color = selectedColor;
        heading.style.fontFamily = 'LemonMilk';
        heading.style.fontSize = '5vh';
        heading.style.textAlign = 'center';
    </script>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=H0rPOKnv"></script>
</body>

</html>